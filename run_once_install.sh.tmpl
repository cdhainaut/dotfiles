#!/bin/bash
set -euo pipefail

echo "ğŸ”§ Mise Ã  jour du systÃ¨me"
sudo apt update && sudo apt upgrade -y

### 1. Install Zsh ###
if ! command -v zsh >/dev/null; then
    echo "â¡ï¸ Installation de zsh"
    sudo apt install -y zsh
else
    echo "âœ… zsh dÃ©jÃ  installÃ©"
fi

### 2. Install Oh-My-Zsh ###
if [ ! -d "$HOME/.oh-my-zsh" ]; then
    echo "â¡ï¸ Installation de Oh My Zsh"
    sh -c "$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)" "" --unattended
else
    echo "âœ… Oh My Zsh dÃ©jÃ  installÃ©"
fi

### 3. Install Neovim from source ###
if ! command -v nvim >/dev/null; then
    echo "â¡ï¸ Installation de Neovim depuis les sources"
    sudo apt install -y ninja-build gettext cmake unzip curl git build-essential

    git clone https://github.com/neovim/neovim.git /tmp/neovim
    cd /tmp/neovim
    git checkout stable
    make CMAKE_BUILD_TYPE=Release
    sudo make install
    echo "âœ… Neovim installÃ©"
else
    echo "âœ… Neovim dÃ©jÃ  installÃ©"
fi

### 4. Install Miniconda ###
if ! command -v conda >/dev/null; then
    echo "â¡ï¸ Installation de Miniconda"
    curl -fsSL https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh -o /tmp/miniconda.sh
    bash /tmp/miniconda.sh -b -p "$HOME/miniconda"
    "$HOME/miniconda/bin/conda" init zsh
    echo "âœ… Miniconda installÃ©"
else
    echo "âœ… Miniconda dÃ©jÃ  installÃ©"
fi

echo "ğŸ‰ Stack de dÃ©veloppement installÃ©e avec succÃ¨s"
